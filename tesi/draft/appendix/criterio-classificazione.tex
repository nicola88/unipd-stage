\chapter{Criterio di classificazione}
\label{ch:appendice:classificazione}

\section*{Legenda}

\subsection*{Entità}
\begin{description}
	\item[$D$] \hfill \\
	Dominio delle entità.
	\item[$d_i$] \hfill \\
	Entità del dominio ($d_i \in D$).\\
	$1 \leq i \leq \left|D\right|,\; i \in \mathbb{N}$.
\end{description}	

\subsection*{Etichette}
\begin{description}
	\item[$E$] \hfill \\
	Dizionario delle etichette.
	\item[$E_i$] \hfill \\
	Insieme delle etichette relative all'entità $d_i$ ($E_i \subset E$).
	\item[$e_j$] \hfill \\
	Etichetta del dizionario ($e_j \in E$).\\
	$1 \leq j \leq \left|E\right|,\; j \in \mathbb{N}$.
	\item[$e_{i,j}$] \hfill \\
	Etichetta del dizionario relativa all'entità $d_i$ ($e_{i,j} \in E$).
	\item[$e_{i,0}$] \hfill \\
	Etichetta primaria dell'entità $d_i$ ($e_{i,0} \in E$).
\end{description}

\subsection*{Accezioni}
\begin{description}
	\item[$A_j$] \hfill \\
	Insieme delle accezioni di un'etichetta $e_j$.
	\item[$a_{j,k}$] \hfill \\
	Accezione di un'etichetta $e_j$ ($a_{j,k} \in A_j$).\\
	$1 \leq k \leq \left|A_j\right|,\; j \in \mathbb{N}$.
\end{description}

\section*{Codice SQL}

\subsection*{Etichette}

\paragraph{Ricerca di un'etichetta}
Restituisce le stringe corrispondenti alla sequenza di caratteri inserita dall'utente, eventualmente adeguata allo standard di formato previsto.

\begin{verbatim}
SELECT *
  FROM etichette	
 WHERE valore LIKE '@etichetta%'
\end{verbatim}
	
\paragraph{Ricerca delle accezioni di un'etichetta}
Restituisce la lista delle accezioni di un'etichetta.
	
\begin{verbatim}
SELECT *
  FROM accezioni	
 WHERE etichetta='@etichetta'
\end{verbatim}

\paragraph{Numero di assegnazioni di un'etichetta}
Restituisce il numero di contenuti cui sia stata assegnata l'etichetta \textsf{@etichetta}.

\begin{verbatim}
SELECT COUNT(*) AS num
  FROM classificazione
 WHERE etichetta='@etichetta'
\end{verbatim}

\paragraph{Inserimento di un'etichetta}
	
\begin{verbatim}
INSERT INTO etichette
     VALUES (@stringa,current_timestamp)
\end{verbatim}

Ad ogni etichetta dev'essere associata almeno un'accezione.

\begin{verbatim}
INSERT INTO accezioni(etichetta,entita)
     VALUES (@etichetta,@entita)
\end{verbatim}
	
\subsection*{Entità}
	
\paragraph{Calcolo di affinità tra due entità}
L'affinità tra due entita primarie è espressa dal numero di contenuti in cui compaiano entrambe.
\begin{verbatim}
  SELECT contenuto, COUNT(*)
    FROM classificazione
   WHERE entita='@entita1' OR entita='@entita2'
GROUP BY contenuto
  HAVING COUNT(*)>=2
\end{verbatim}

\paragraph{Ricerca delle entità referenti}
Restituisce la lista delle entità che riferiscono \textsf{@entita}.
\begin{verbatim}
SELECT e.etichetta AS figlio
  FROM gerarchia AS g JOIN entita AS e
       ON (g.figlio=e.id)
 WHERE padre='@entita'
\end{verbatim}

\paragraph{Ricerca delle entità riferite}
Restituisce la lista delle entità riferite da \textsf{@entita}.
\begin{verbatim}
SELECT e.etichetta AS padre
  FROM gerarchia AS g JOIN entita AS e
       ON (g.padre=e.id)
 WHERE figlio='@entita'
\end{verbatim}

\paragraph{Ricerca delle etichette}
Restituisce la lista delle etichette con cui è riferibile una determinata entità del dominio.
\begin{verbatim}
SELECT etichetta
  FROM accezioni AS s JOIN entita AS e
       ON (s.entita=e.id)
 WHERE s.entita='@entita'
\end{verbatim}

\subsection*{Contenuti}
\paragraph{Assegnazione di un'etichetta}
\begin{verbatim}
INSERT INTO classificazione(contenuto,entita)
     VALUES (@contenuto,@entita)
\end{verbatim}

\paragraph{Ricerca delle etichette assegnate}
Il reperimento della lista delle etichette primarie assegnate ad un contenuto richiede di consultare le tabelle \texttt{classificazione} ed \texttt{entita}.
\begin{verbatim}
SELECT e.etichetta
  FROM classificazione AS c JOIN entita AS e
       ON (c.entita=e.id)
 WHERE contenuto='@contenuto'
\end{verbatim}

\paragraph{Ricerca di contenuti generici}
La ricerca dei contenuti cui sia stata assegnata una certa etichetta richiede di consultare la tabella \texttt{classificazione}.
\begin{verbatim}
SELECT contenuti
  FROM classificazione
 WHERE entita='@entita'
\end{verbatim}

\paragraph{Ricerca di contenuti specifici}
La ricerca di contenuti specifici consiste nell'individuare i contenuti cui siano state assegnate - tra le altre - determinate etichette (due o più) specificate dall'utente. 
\begin{verbatim}
  SELECT contenuto, COUNT(etichetta)
    FROM classificazione
   WHERE entita='@entita1' [OR entita='@entita2' ...]
GROUP BY contenuto
  HAVING COUNT(*)>=@num_etichette
\end{verbatim}
